ARG TF_VERSION=2.19.0-gpu
FROM tensorflow/tensorflow:$TF_VERSION
LABEL maintainer "KT <ktsiknos@brainchip.com>"

RUN apt-get update && apt-get install libgl1-mesa-glx libasound2-dev -y
RUN python -m pip install --upgrade pip && \
    pip install torch==2.7.0 torchvision --index-url https://download.pytorch.org/whl/cu118 && \
    pip install tensorflow[and-cuda]==2.19.0 \
                tf_keras~=2.19.0 \
                sphinx \
                sphinx_rtd_theme \
                sphinx-gallery \
                sphinx_design \
                sphinxcontrib-video \
                autodocsumm \
                matplotlib \
                scikit-learn \
                tensorflow-datasets \
                scipy \
                opencv-python \
                mtcnn==0.1.1 \
                imaug \
                trimesh \
                librosa \
                soundata \
                tensorboardX \
                optimum[exporters]==1.23.3 \
                onnxscript~=0.4.0 \
                onnxruntime~=1.19.2 \
                torchinfo==1.8.0 \
                flake8==4.0.1

ENV TF_FORCE_GPU_ALLOW_GROWTH=true

# Install a newer version of libstdc++6 to be compatible with an Akida build on Ubuntu 24.04.
# Please note that this may cause compatibility issues with certain packages.
RUN echo "deb http://archive.ubuntu.com/ubuntu noble main" | tee /etc/apt/sources.list.d/noble.list \
    && apt update \
    && apt install -y libstdc++6 \
    && rm /etc/apt/sources.list.d/noble.list \
    && apt update

CMD ["/bin/bash"]
