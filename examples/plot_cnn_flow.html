

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CNN conversion flow tutorial &mdash; Akida Examples  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DS-CNN/KWS inference" href="plot_ds_cnn_kws.html" />
    <link rel="prev" title="Akida vision edge learning" href="plot_edge_learning_vision.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #3f51b5" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/akida.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                Akida 1.8.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#quick-installation">Quick installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#running-examples">Running examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/user_guide.html">User guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/getting_started.html">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/getting_started.html#for-beginners">For beginners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/getting_started.html#for-users-familiar-with-deep-learning">For users familiar with deep-learning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/aee.html">Akida user guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/aee.html#the-akida-execution-engine">The Akida Execution Engine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#id1">1. The Spiking Neural Network model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#id2">2. Input data format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#id3">3. Determine training mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#id4">4. Interpreting outputs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/aee.html#neural-network-model">Neural Network model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#specifying-the-neural-network-model">Specifying the Neural Network model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#saving-and-loading">Saving and loading</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#input-layer-types">Input layer types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#data-processing-layer-types">Data-Processing layer types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/aee.html#id5">Using Akida Unsupervised Learning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#learning-constraints">Learning constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#compiling-a-layer">Compiling a layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/aee.html#id6">Learning parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/cnn2snn.html">CNN2SNN toolkit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/cnn2snn.html#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#conversion-workflow">Conversion workflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#typical-training-scenario">Typical training scenario</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#design-compatibility-constraints">Design compatibility constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#quantization-compatibility-constraints">Quantization compatibility constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#command-line-interface">Command-line interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/cnn2snn.html#layers-considerations">Layers Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#supported-layer-types">Supported layer types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#cnn2snn-quantization-aware-layers">CNN2SNN Quantization-aware layers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#training-only-layers">Training-Only Layers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#first-layers">First Layers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/cnn2snn.html#id6">Final Layers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/cnn2snn.html#tips-and-tricks">Tips and Tricks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/akida_models.html">Akida models zoo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/akida_models.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/akida_models.html#command-line-interface-for-model-creation">Command-line interface for model creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/akida_models.html#command-line-interface-for-model-training">Command-line interface for model training</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/akida_models.html#cifar10-training-and-tuning">CIFAR10 training and tuning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/akida_models.html#utk-face-training">UTK Face training</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/akida_models.html#kws-training">KWS training</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/akida_models.html#yolo-training">YOLO training</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/akida_models.html#id1">Layer Blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/akida_models.html#conv-block"><code class="docutils literal notranslate"><span class="pre">conv_block</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/akida_models.html#dense-block"><code class="docutils literal notranslate"><span class="pre">dense_block</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/akida_models.html#separable-conv-block"><code class="docutils literal notranslate"><span class="pre">separable_conv_block</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/hw_constraints.html">Hardware constraints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/hw_constraints.html#input-layer">Input layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/hw_constraints.html#data-processing-layers">Data-Processing layers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/hw_constraints.html#convolutional-layer">Convolutional layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user_guide/hw_constraints.html#fully-connected-layer">Fully connected layer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/compatibility.html">Akida versions compatibility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide/compatibility.html#upgrading-models-with-legacy-quantizers">Upgrading models with legacy quantizers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/api_reference.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/aee_apis.html">Akida Execution Engine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#model">Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#layer">Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#layerstatistics">LayerStatistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#observer">Observer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#inputdata">InputData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#inputconvolutional">InputConvolutional</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#fullyconnected">FullyConnected</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#convolutional">Convolutional</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#separableconvolutional">SeparableConvolutional</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#dense">Dense</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#sparse">Sparse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#coords-to-sparse">coords_to_sparse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#dense-to-sparse">dense_to_sparse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#packetize">packetize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#backend">Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#convolutionmode">ConvolutionMode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#poolingtype">PoolingType</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#learningtype">LearningType</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/aee_apis.html#compatibility">Compatibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/cnn2snn_apis.html">CNN2SNN</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#tool-functions">Tool functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantize">quantize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantize-layer">quantize_layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#convert">convert</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#check-model-compatibility">check_model_compatibility</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#load-quantized-model">load_quantized_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#load-partial-weights">load_partial_weights</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantizers">Quantizers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#weightquantizer">WeightQuantizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#linearweightquantizer">LinearWeightQuantizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#stdweightquantizer">StdWeightQuantizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#trainablestdweightquantizer">TrainableStdWeightQuantizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#maxquantizer">MaxQuantizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#maxperaxisquantizer">MaxPerAxisQuantizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#weightfloat">WeightFloat</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantized-layers">Quantized layers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantizedconv2d">QuantizedConv2D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantizeddepthwiseconv2d">QuantizedDepthwiseConv2D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantizeddense">QuantizedDense</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantizedseparableconv2d">QuantizedSeparableConv2D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantizedactivation">QuantizedActivation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#activationdiscreterelu">ActivationDiscreteRelu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/cnn2snn_apis.html#quantizedrelu">QuantizedReLU</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/akida_models_apis.html">Akida models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/akida_models_apis.html#layer-blocks">Layer blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/akida_models_apis.html#conv-block">conv_block</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/akida_models_apis.html#separable-conv-block">separable_conv_block</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/akida_models_apis.html#dense-block">dense_block</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api_reference/akida_models_apis.html#model-zoo">Model zoo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/akida_models_apis.html#mobilenet">Mobilenet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/akida_models_apis.html#ds-cnn">DS-CNN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/akida_models_apis.html#vgg">VGG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api_reference/akida_models_apis.html#yolo">YOLO</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_gxnor_mnist.html">GXNOR/MNIST inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_gxnor_mnist.html#dataset-preparation">1. Dataset preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_gxnor_mnist.html#load-the-pre-trained-akida-model">2. Load the pre-trained Akida model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_gxnor_mnist.html#show-predictions-for-a-single-image">3. Show predictions for a single image</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_gxnor_mnist.html#check-performance">4. Check performance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_regression.html">Regression tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_regression.html#load-the-dataset">1. Load the dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_regression.html#load-a-pre-trained-native-keras-model">2. Load a pre-trained native Keras model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_regression.html#load-a-pre-trained-quantized-keras-model-satisfying-akida-nsoc-requirements">3. Load a pre-trained quantized Keras model satisfying Akida NSoC requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_regression.html#conversion-to-akida">4. Conversion to Akida</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_regression.html#estimate-age-on-a-single-image">5. Estimate age on a single image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_edge_learning_vision.html">Akida vision edge learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_vision.html#dataset-preparation">1. Dataset preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_vision.html#prepare-akida-model-for-learning">2. Prepare Akida model for learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_vision.html#edge-learning-with-akida">3. Edge learning with Akida</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">CNN conversion flow tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#load-and-reshape-mnist-dataset">1. Load and reshape MNIST dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-definition">2. Model definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#model-training">3. Model training</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-quantization">4. Model quantization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-fine-tuning-quantization-aware-training">5. Model fine tuning (quantization-aware training)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-conversion">6. Model conversion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_ds_cnn_kws.html">DS-CNN/KWS inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_ds_cnn_kws.html#load-the-preprocessed-dataset">1. Load the preprocessed dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_ds_cnn_kws.html#load-a-pre-trained-native-keras-model">2. Load a pre-trained native Keras model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_ds_cnn_kws.html#load-a-pre-trained-quantized-keras-model-satisfying-akida-nsoc-requirements">3. Load a pre-trained quantized Keras model satisfying Akida NSoC requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_ds_cnn_kws.html#conversion-to-akida">4. Conversion to Akida</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_ds_cnn_kws.html#confusion-matrix">5. Confusion matrix</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_ds_cnn_cifar10.html">DS-CNN CIFAR10 inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_ds_cnn_cifar10.html#dataset-preparation">1. Dataset preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_ds_cnn_cifar10.html#create-a-keras-ds-cnn-model">2. Create a Keras DS-CNN model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_ds_cnn_cifar10.html#quantized-model">3. Quantized model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_ds_cnn_cifar10.html#pretrained-quantized-model">4. Pretrained quantized model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_ds_cnn_cifar10.html#conversion-to-akida">5. Conversion to Akida</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_ds_cnn_cifar10.html#convert-to-akida-model">5.1 Convert to Akida model</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_ds_cnn_cifar10.html#check-hardware-compliancy">5.2 Check hardware compliancy</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_ds_cnn_cifar10.html#check-performance">5.3 Check performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_ds_cnn_cifar10.html#show-predictions-for-a-random-image">5.4 Show predictions for a random image</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_advanced_cnn2snn.html">Advanced CNN2SNN tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_advanced_cnn2snn.html#design-a-cnn2snn-quantized-model">1. Design a CNN2SNN quantized model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#quantized-neural-layers">Quantized neural layers</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#quantized-activation-layers">Quantized activation layers</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#load-pre-trained-weights-from-a-native-keras-model">Load pre-trained weights from a native Keras model</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#create-a-quantized-model">Create a quantized model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plot_advanced_cnn2snn.html#weight-quantizer-details">2. Weight Quantizer Details</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#how-a-weight-quantizer-works">How a weight quantizer works</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#how-to-create-a-custom-weight-quantizer">How to create a custom weight quantizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#why-use-a-different-quantizer">Why use a different quantizer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plot_advanced_cnn2snn.html#quantized-activation-layer-details">3. Quantized Activation Layer Details</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#how-a-quantized-activation-works">How a quantized activation works</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#how-to-create-a-custom-quantized-activation-layer">How to create a custom quantized activation layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_advanced_cnn2snn.html#why-use-a-different-quantized-activation">Why use a different quantized activation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_edge_learning_parameters.html">Tips to set Akida learning parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_parameters.html#akida-learning-parameters">1. Akida learning parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_parameters.html#create-akida-model">2. Create Akida model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_parameters.html#estimate-the-required-number-of-weights-of-the-trainable-layer">3. Estimate the required number of weights of the trainable layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_parameters.html#estimate-the-number-of-neurons-per-class">4. Estimate the number of neurons per class</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_voc_yolo_detection.html">YOLO/PASCAL-VOC detection tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_voc_yolo_detection.html#introduction">1. Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_voc_yolo_detection.html#object-detection">1.1 Object detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_voc_yolo_detection.html#yolo-key-concepts">1.2 YOLO key concepts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plot_voc_yolo_detection.html#preprocessing-tools">2. Preprocessing tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_voc_yolo_detection.html#model-architecture">3. Model architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_voc_yolo_detection.html#training">4. Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_voc_yolo_detection.html#performance">5. Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_voc_yolo_detection.html#conversion-to-akida">6. Conversion to Akida</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_voc_yolo_detection.html#convert-to-akida-model">6.1 Convert to Akida model</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_voc_yolo_detection.html#check-performance">6.1 Check performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_voc_yolo_detection.html#show-predictions-for-a-random-image">6.2 Show predictions for a random image</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_transfer_learning.html">Transfer learning with MobileNet for cats vs. dogs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_transfer_learning.html#transfer-learning-process">Transfer learning process</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_transfer_learning.html#load-and-preprocess-data">1. Load and preprocess data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_transfer_learning.html#a-load-and-split-data">1.A - Load and split data</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_transfer_learning.html#b-preprocess-the-test-set">1.B - Preprocess the test set</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_transfer_learning.html#c-get-labels">1.C - Get labels</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plot_transfer_learning.html#modify-a-pre-trained-base-keras-model">2. Modify a pre-trained base Keras model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_transfer_learning.html#a-instantiate-a-keras-base-model">2.A - Instantiate a Keras base model</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_transfer_learning.html#b-modify-the-network-for-the-new-task">2.B - Modify the network for the new task</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plot_transfer_learning.html#train-the-transferred-model-for-the-new-task">3. Train the transferred model for the new task</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_transfer_learning.html#quantize-the-top-layer">4 Quantize the top layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_transfer_learning.html#convert-to-akida">5. Convert to Akida</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_transfer_learning.html#plot-confusion-matrix">6. Plot confusion matrix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_edge_learning_kws.html">Akida edge learning for keyword spotting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_kws.html#edge-learning-process">1. Edge learning process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_edge_learning_kws.html#akida-model-preparation">1.1 Akida model preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_edge_learning_kws.html#offline-akida-learning">1.2 “Offline” Akida learning</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_edge_learning_kws.html#online-edge-learning">1.3 “Online” edge learning</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_kws.html#dataset-preparation">2. Dataset preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_kws.html#prepare-akida-model-for-learning">3. Prepare Akida model for learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_kws.html#learn-with-akida-using-the-training-set">4. Learn with Akida using the training set</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_edge_learning_kws.html#edge-learning">4. Edge learning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_mobilenet_imagenet.html">MobileNet/ImageNet inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plot_mobilenet_imagenet.html#dataset-preparation">1. Dataset preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_mobilenet_imagenet.html#create-a-keras-mobilenet-model">2. Create a Keras MobileNet model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_mobilenet_imagenet.html#quantized-model">3. Quantized model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_mobilenet_imagenet.html#pretrained-quantized-model">4. Pretrained quantized model</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_mobilenet_imagenet.html#conversion-to-akida">5. Conversion to Akida</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plot_mobilenet_imagenet.html#convert-to-akida-model">5.1 Convert to Akida model</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_mobilenet_imagenet.html#check-hardware-compliancy">5.2 Check hardware compliancy</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_mobilenet_imagenet.html#check-performance">5.3 Check performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_mobilenet_imagenet.html#show-predictions-for-a-random-image">5.4 Show predictions for a random image</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Brainchip-Inc/akida_examples/releases">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://support.brainchip.com/portal/home">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Akida Examples</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Akida examples</a> &raquo;</li>
        
      <li>CNN conversion flow tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-plot-cnn-flow-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="cnn-conversion-flow-tutorial">
<span id="sphx-glr-examples-plot-cnn-flow-py"></span><h1>CNN conversion flow tutorial<a class="headerlink" href="#cnn-conversion-flow-tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial illustrates how to use the CNN2SNN toolkit to <strong>convert CNN
networks to SNN networks</strong> compatible with the <strong>Akida NSoC</strong> in a few steps.
You can refer to our <a class="reference external" href="https://doc.brainchipinc.com/user_guide/cnn2snn.html">CNN2SNN toolkit user guide</a> for further
explanation.</p>
<p>The CNN2SNN tool is based on Keras, TensorFlow high-level API for building and
training deep learning models.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please refer to TensorFlow  <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/models">tf.keras.models</a>
module for model creation/import details and <a class="reference external" href="https://www.tensorflow.org/guide">TensorFlow
Guide</a> for details of how
TensorFlow works.</p>
<p>MNIST example below is light enough so you do not need a <a class="reference external" href="https://www.tensorflow.org/install/gpu">GPU</a> to run the CNN2SNN
tool.</p>
</div>
<a class="reference internal image-reference" href="../_images/cnn2snn_flow_small.jpg"><img alt="../_images/cnn2snn_flow_small.jpg" src="../_images/cnn2snn_flow_small.jpg" style="width: 725.9px; height: 170.1px;" /></a>
<div class="section" id="load-and-reshape-mnist-dataset">
<h2>1. Load and reshape MNIST dataset<a class="headerlink" href="#load-and-reshape-mnist-dataset" title="Permalink to this headline">¶</a></h2>
<p>After loading, we make 2 transformations on the dataset:</p>
<ol class="arabic simple">
<li><p>Reshape the sample content data (x values) into a num_samples x width x
height x channels matrix.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At this point, we’ll set aside the raw data for testing our
converted model in the Akida Execution Engine later.</p>
</div>
<ol class="arabic simple" start="2">
<li><p>Rescale the 8-bit loaded data to the range 0-to-1 for training.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Input data normalization is a common step dealing with CNN
(rationale is to keep data in a range that works with selected
optimizers, some reading can be found
<a class="reference external" href="https://www.jeremyjordan.me/batch-normalization/">here</a>.</p>
<p>This shift makes almost no difference in the current example, but
for some datasets rescaling the absolute values (and also shifting
to zero-mean) can make a really major difference.</p>
<p>Also note that we store the scaling values <code class="docutils literal notranslate"><span class="pre">input_scaling</span></code> for
use when preparing the model for the Akida Execution Engine. The
implementation of the Akida neural network allows us to completely
skip the rescaling step (i.e. the Akida model should be fed with
the raw 8-bit values) but that does require information about what
scaling was applied prior to training - see below for more details.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>

<span class="c1"># Load MNIST dataset</span>
<span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">mnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

<span class="c1"># Reshape x-data</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">60000</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Set aside raw test data for use with Akida Execution Engine later</span>
<span class="n">raw_x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
<span class="n">raw_y_test</span> <span class="o">=</span> <span class="n">y_test</span>

<span class="c1"># Rescale x-data</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">255</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">input_scaling</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_train</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_test</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span>
</pre></div>
</div>
</div>
<div class="section" id="model-definition">
<h2>2. Model definition<a class="headerlink" href="#model-definition" title="Permalink to this headline">¶</a></h2>
<p>Note that at this stage, there is nothing specific to the Akida NSoC.
This start point is very much a completely standard CNN as defined
within <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras">Keras</a>.</p>
<p>An appropriate model for MNIST (inspired by <a class="reference external" href="https://www.tensorflow.org/model_optimization/guide/quantization/training_example#train_a_model_for_mnist_without_quantization_aware_training">this
example</a>)
might look something like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_keras</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPool2D</span><span class="p">(),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">BatchNormalization</span><span class="p">(),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">SeparableConv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPool2D</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">BatchNormalization</span><span class="p">(),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">],</span> <span class="s1">&#39;mnistnet&#39;</span><span class="p">)</span>

<span class="n">model_keras</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Model: &quot;mnistnet&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
conv2d (Conv2D)              (None, 26, 26, 32)        320
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 13, 13, 32)        0
_________________________________________________________________
batch_normalization (BatchNo (None, 13, 13, 32)        128
_________________________________________________________________
re_lu (ReLU)                 (None, 13, 13, 32)        0
_________________________________________________________________
separable_conv2d (SeparableC (None, 13, 13, 64)        2400
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 7, 7, 64)          0
_________________________________________________________________
batch_normalization_1 (Batch (None, 7, 7, 64)          256
_________________________________________________________________
re_lu_1 (ReLU)               (None, 7, 7, 64)          0
_________________________________________________________________
flatten (Flatten)            (None, 3136)              0
_________________________________________________________________
dense (Dense)                (None, 10)                31370
=================================================================
Total params: 34,474
Trainable params: 34,282
Non-trainable params: 192
_________________________________________________________________
</pre></div>
</div>
<p>The model defined above is compatible for conversion into an Akida model, i.e.
the model doesn’t include any layers or operations that aren’t Akida-compatible
(please refer to the <a class="reference external" href="../user_guide/cnn2snn.html">CNN2SNN toolkit</a> documentation for full
details):</p>
<ul class="simple">
<li><p>Standard Conv2D and Dense layers are supported</p></li>
<li><p>Hidden layers must be followed  by a ReLU layer.</p></li>
<li><p>BatchNormalization must always happen before activations.</p></li>
<li><p>Convolutional blocks can optionally be followed by a MaxPooling.</p></li>
</ul>
<p>The CNN2SNN toolkit provides the
<a class="reference external" href="../api_reference/cnn2snn_apis.html#check-model-compatibility">check_model_compatibility</a>
function to ensure that the model can be converted into an Akida model. If
the model is not fully compatible, substitutes will be needed for the
relevant layers/operations (guidelines included in the documentation).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cnn2snn</span> <span class="kn">import</span> <span class="n">check_model_compatibility</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model compatible for Akida conversion:&quot;</span><span class="p">,</span>
      <span class="n">check_model_compatibility</span><span class="p">(</span><span class="n">model_keras</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Model compatible for Akida conversion: True
</pre></div>
</div>
<div class="section" id="model-training">
<h3>3. Model training<a class="headerlink" href="#model-training" title="Permalink to this headline">¶</a></h3>
<p>Before going any further, train the model and get its performance.
The created model should have achieved a test accuracy a little over 99% after
10 epochs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_keras</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

<span class="n">model_keras</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">score</span> <span class="o">=</span> <span class="n">model_keras</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test score:&#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test accuracy:&#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Epoch 1/10

   1/1688 [..............................] - ETA: 0s - loss: 2.7706 - accuracy: 0.0000e+00
  33/1688 [..............................] - ETA: 2s - loss: 0.9834 - accuracy: 0.6837    
  65/1688 [&gt;.............................] - ETA: 2s - loss: 0.6471 - accuracy: 0.7952
  96/1688 [&gt;.............................] - ETA: 2s - loss: 0.5113 - accuracy: 0.8398
 128/1688 [=&gt;............................] - ETA: 2s - loss: 0.4331 - accuracy: 0.8650
 160/1688 [=&gt;............................] - ETA: 2s - loss: 0.3743 - accuracy: 0.8850
 192/1688 [==&gt;...........................] - ETA: 2s - loss: 0.3383 - accuracy: 0.8965
 224/1688 [==&gt;...........................] - ETA: 2s - loss: 0.3127 - accuracy: 0.9050
 256/1688 [===&gt;..........................] - ETA: 2s - loss: 0.2912 - accuracy: 0.9121
 288/1688 [====&gt;.........................] - ETA: 2s - loss: 0.2694 - accuracy: 0.9187
 320/1688 [====&gt;.........................] - ETA: 2s - loss: 0.2534 - accuracy: 0.9241
 352/1688 [=====&gt;........................] - ETA: 2s - loss: 0.2434 - accuracy: 0.9275
 384/1688 [=====&gt;........................] - ETA: 2s - loss: 0.2319 - accuracy: 0.9311
 416/1688 [======&gt;.......................] - ETA: 2s - loss: 0.2219 - accuracy: 0.9340
 448/1688 [======&gt;.......................] - ETA: 1s - loss: 0.2126 - accuracy: 0.9367
 480/1688 [=======&gt;......................] - ETA: 1s - loss: 0.2055 - accuracy: 0.9390
 512/1688 [========&gt;.....................] - ETA: 1s - loss: 0.2004 - accuracy: 0.9404
 544/1688 [========&gt;.....................] - ETA: 1s - loss: 0.1945 - accuracy: 0.9418
 576/1688 [=========&gt;....................] - ETA: 1s - loss: 0.1888 - accuracy: 0.9435
 608/1688 [=========&gt;....................] - ETA: 1s - loss: 0.1829 - accuracy: 0.9455
 639/1688 [==========&gt;...................] - ETA: 1s - loss: 0.1786 - accuracy: 0.9466
 671/1688 [==========&gt;...................] - ETA: 1s - loss: 0.1749 - accuracy: 0.9477
 704/1688 [===========&gt;..................] - ETA: 1s - loss: 0.1725 - accuracy: 0.9485
 736/1688 [============&gt;.................] - ETA: 1s - loss: 0.1685 - accuracy: 0.9496
 768/1688 [============&gt;.................] - ETA: 1s - loss: 0.1659 - accuracy: 0.9504
 799/1688 [=============&gt;................] - ETA: 1s - loss: 0.1624 - accuracy: 0.9513
 831/1688 [=============&gt;................] - ETA: 1s - loss: 0.1597 - accuracy: 0.9520
 864/1688 [==============&gt;...............] - ETA: 1s - loss: 0.1562 - accuracy: 0.9531
 895/1688 [==============&gt;...............] - ETA: 1s - loss: 0.1535 - accuracy: 0.9536
 927/1688 [===============&gt;..............] - ETA: 1s - loss: 0.1516 - accuracy: 0.9543
 958/1688 [================&gt;.............] - ETA: 1s - loss: 0.1489 - accuracy: 0.9551
 990/1688 [================&gt;.............] - ETA: 1s - loss: 0.1471 - accuracy: 0.9557
1022/1688 [=================&gt;............] - ETA: 1s - loss: 0.1448 - accuracy: 0.9564
1053/1688 [=================&gt;............] - ETA: 1s - loss: 0.1421 - accuracy: 0.9573
1085/1688 [==================&gt;...........] - ETA: 0s - loss: 0.1398 - accuracy: 0.9580
1117/1688 [==================&gt;...........] - ETA: 0s - loss: 0.1372 - accuracy: 0.9587
1149/1688 [===================&gt;..........] - ETA: 0s - loss: 0.1354 - accuracy: 0.9593
1181/1688 [===================&gt;..........] - ETA: 0s - loss: 0.1339 - accuracy: 0.9595
1213/1688 [====================&gt;.........] - ETA: 0s - loss: 0.1323 - accuracy: 0.9600
1245/1688 [=====================&gt;........] - ETA: 0s - loss: 0.1306 - accuracy: 0.9604
1277/1688 [=====================&gt;........] - ETA: 0s - loss: 0.1291 - accuracy: 0.9609
1308/1688 [======================&gt;.......] - ETA: 0s - loss: 0.1275 - accuracy: 0.9614
1340/1688 [======================&gt;.......] - ETA: 0s - loss: 0.1257 - accuracy: 0.9619
1372/1688 [=======================&gt;......] - ETA: 0s - loss: 0.1243 - accuracy: 0.9623
1404/1688 [=======================&gt;......] - ETA: 0s - loss: 0.1233 - accuracy: 0.9626
1437/1688 [========================&gt;.....] - ETA: 0s - loss: 0.1220 - accuracy: 0.9630
1469/1688 [=========================&gt;....] - ETA: 0s - loss: 0.1207 - accuracy: 0.9633
1501/1688 [=========================&gt;....] - ETA: 0s - loss: 0.1198 - accuracy: 0.9635
1533/1688 [==========================&gt;...] - ETA: 0s - loss: 0.1190 - accuracy: 0.9637
1565/1688 [==========================&gt;...] - ETA: 0s - loss: 0.1179 - accuracy: 0.9640
1597/1688 [===========================&gt;..] - ETA: 0s - loss: 0.1171 - accuracy: 0.9644
1629/1688 [===========================&gt;..] - ETA: 0s - loss: 0.1158 - accuracy: 0.9648
1661/1688 [============================&gt;.] - ETA: 0s - loss: 0.1150 - accuracy: 0.9649
1688/1688 [==============================] - ETA: 0s - loss: 0.1144 - accuracy: 0.9652
1688/1688 [==============================] - 3s 2ms/step - loss: 0.1144 - accuracy: 0.9652 - val_loss: 0.0524 - val_accuracy: 0.9840
Epoch 2/10

   1/1688 [..............................] - ETA: 0s - loss: 0.0128 - accuracy: 1.0000
  36/1688 [..............................] - ETA: 2s - loss: 0.0485 - accuracy: 0.9887
  68/1688 [&gt;.............................] - ETA: 2s - loss: 0.0465 - accuracy: 0.9899
 100/1688 [&gt;.............................] - ETA: 2s - loss: 0.0444 - accuracy: 0.9878
 131/1688 [=&gt;............................] - ETA: 2s - loss: 0.0430 - accuracy: 0.9871
 162/1688 [=&gt;............................] - ETA: 2s - loss: 0.0421 - accuracy: 0.9869
 194/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0430 - accuracy: 0.9863
 226/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0452 - accuracy: 0.9853
 258/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0476 - accuracy: 0.9847
 290/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0485 - accuracy: 0.9845
 321/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0498 - accuracy: 0.9844
 353/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0485 - accuracy: 0.9848
 385/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0484 - accuracy: 0.9850
 417/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0470 - accuracy: 0.9855
 449/1688 [======&gt;.......................] - ETA: 1s - loss: 0.0465 - accuracy: 0.9853
 481/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0459 - accuracy: 0.9853
 513/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0453 - accuracy: 0.9853
 544/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0452 - accuracy: 0.9856
 576/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0447 - accuracy: 0.9857
 608/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0446 - accuracy: 0.9856
 640/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0450 - accuracy: 0.9855
 672/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0452 - accuracy: 0.9855
 704/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0460 - accuracy: 0.9855
 735/1688 [============&gt;.................] - ETA: 1s - loss: 0.0469 - accuracy: 0.9852
 766/1688 [============&gt;.................] - ETA: 1s - loss: 0.0470 - accuracy: 0.9852
 798/1688 [=============&gt;................] - ETA: 1s - loss: 0.0474 - accuracy: 0.9848
 830/1688 [=============&gt;................] - ETA: 1s - loss: 0.0469 - accuracy: 0.9851
 862/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0467 - accuracy: 0.9850
 895/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0472 - accuracy: 0.9851
 927/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0469 - accuracy: 0.9851
 959/1688 [================&gt;.............] - ETA: 1s - loss: 0.0465 - accuracy: 0.9851
 991/1688 [================&gt;.............] - ETA: 1s - loss: 0.0468 - accuracy: 0.9851
1023/1688 [=================&gt;............] - ETA: 1s - loss: 0.0470 - accuracy: 0.9849
1055/1688 [=================&gt;............] - ETA: 1s - loss: 0.0473 - accuracy: 0.9848
1087/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0481 - accuracy: 0.9847
1119/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0476 - accuracy: 0.9849
1152/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0480 - accuracy: 0.9846
1186/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0479 - accuracy: 0.9846
1218/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0484 - accuracy: 0.9845
1250/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0485 - accuracy: 0.9846
1282/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0486 - accuracy: 0.9846
1314/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0485 - accuracy: 0.9847
1346/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0483 - accuracy: 0.9847
1378/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0480 - accuracy: 0.9849
1410/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0484 - accuracy: 0.9847
1442/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0489 - accuracy: 0.9846
1473/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0500 - accuracy: 0.9844
1505/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0505 - accuracy: 0.9841
1537/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0505 - accuracy: 0.9841
1569/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0502 - accuracy: 0.9842
1601/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0498 - accuracy: 0.9843
1633/1688 [============================&gt;.] - ETA: 0s - loss: 0.0498 - accuracy: 0.9843
1665/1688 [============================&gt;.] - ETA: 0s - loss: 0.0497 - accuracy: 0.9844
1688/1688 [==============================] - 3s 2ms/step - loss: 0.0498 - accuracy: 0.9844 - val_loss: 0.0770 - val_accuracy: 0.9798
Epoch 3/10

   1/1688 [..............................] - ETA: 0s - loss: 0.0050 - accuracy: 1.0000
  34/1688 [..............................] - ETA: 2s - loss: 0.0511 - accuracy: 0.9853
  66/1688 [&gt;.............................] - ETA: 2s - loss: 0.0401 - accuracy: 0.9863
  98/1688 [&gt;.............................] - ETA: 2s - loss: 0.0350 - accuracy: 0.9885
 130/1688 [=&gt;............................] - ETA: 2s - loss: 0.0301 - accuracy: 0.9904
 162/1688 [=&gt;............................] - ETA: 2s - loss: 0.0287 - accuracy: 0.9911
 195/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0272 - accuracy: 0.9913
 227/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0277 - accuracy: 0.9911
 259/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0282 - accuracy: 0.9908
 290/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0295 - accuracy: 0.9903
 322/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0302 - accuracy: 0.9898
 353/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0296 - accuracy: 0.9898
 384/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0313 - accuracy: 0.9894
 415/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0314 - accuracy: 0.9895
 447/1688 [======&gt;.......................] - ETA: 1s - loss: 0.0321 - accuracy: 0.9893
 478/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0314 - accuracy: 0.9897
 509/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0311 - accuracy: 0.9899
 541/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0316 - accuracy: 0.9899
 572/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0317 - accuracy: 0.9899
 603/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0309 - accuracy: 0.9900
 634/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0303 - accuracy: 0.9901
 665/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0303 - accuracy: 0.9901
 697/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0310 - accuracy: 0.9900
 730/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0314 - accuracy: 0.9898
 762/1688 [============&gt;.................] - ETA: 1s - loss: 0.0316 - accuracy: 0.9895
 794/1688 [=============&gt;................] - ETA: 1s - loss: 0.0321 - accuracy: 0.9893
 826/1688 [=============&gt;................] - ETA: 1s - loss: 0.0318 - accuracy: 0.9895
 858/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0315 - accuracy: 0.9897
 890/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0312 - accuracy: 0.9898
 922/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0313 - accuracy: 0.9898
 954/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0312 - accuracy: 0.9898
 986/1688 [================&gt;.............] - ETA: 1s - loss: 0.0312 - accuracy: 0.9899
1018/1688 [=================&gt;............] - ETA: 1s - loss: 0.0312 - accuracy: 0.9898
1050/1688 [=================&gt;............] - ETA: 1s - loss: 0.0313 - accuracy: 0.9897
1082/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0311 - accuracy: 0.9897
1114/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0312 - accuracy: 0.9897
1146/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0313 - accuracy: 0.9897
1177/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0318 - accuracy: 0.9896
1209/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0317 - accuracy: 0.9895
1242/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0319 - accuracy: 0.9895
1274/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0320 - accuracy: 0.9895
1306/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0321 - accuracy: 0.9895
1336/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0323 - accuracy: 0.9894
1367/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0321 - accuracy: 0.9895
1399/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0324 - accuracy: 0.9893
1431/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0324 - accuracy: 0.9893
1463/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0323 - accuracy: 0.9894
1495/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0322 - accuracy: 0.9894
1527/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0325 - accuracy: 0.9894
1558/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0329 - accuracy: 0.9892
1590/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0327 - accuracy: 0.9893
1622/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0330 - accuracy: 0.9893
1655/1688 [============================&gt;.] - ETA: 0s - loss: 0.0332 - accuracy: 0.9892
1688/1688 [==============================] - ETA: 0s - loss: 0.0331 - accuracy: 0.9893
1688/1688 [==============================] - 3s 2ms/step - loss: 0.0331 - accuracy: 0.9893 - val_loss: 0.0563 - val_accuracy: 0.9858
Epoch 4/10

   1/1688 [..............................] - ETA: 0s - loss: 0.0023 - accuracy: 1.0000
  35/1688 [..............................] - ETA: 2s - loss: 0.0155 - accuracy: 0.9955
  67/1688 [&gt;.............................] - ETA: 2s - loss: 0.0218 - accuracy: 0.9925
  99/1688 [&gt;.............................] - ETA: 2s - loss: 0.0232 - accuracy: 0.9918
 131/1688 [=&gt;............................] - ETA: 2s - loss: 0.0254 - accuracy: 0.9912
 163/1688 [=&gt;............................] - ETA: 2s - loss: 0.0274 - accuracy: 0.9908
 194/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0269 - accuracy: 0.9910
 226/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0262 - accuracy: 0.9913
 258/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0264 - accuracy: 0.9918
 290/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0270 - accuracy: 0.9915
 322/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0276 - accuracy: 0.9913
 354/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0288 - accuracy: 0.9912
 386/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0293 - accuracy: 0.9909
 418/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0291 - accuracy: 0.9907
 450/1688 [======&gt;.......................] - ETA: 1s - loss: 0.0282 - accuracy: 0.9910
 482/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0272 - accuracy: 0.9914
 515/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0264 - accuracy: 0.9916
 546/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0259 - accuracy: 0.9917
 578/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0252 - accuracy: 0.9920
 610/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0252 - accuracy: 0.9918
 642/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0247 - accuracy: 0.9920
 674/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0251 - accuracy: 0.9919
 706/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0247 - accuracy: 0.9921
 738/1688 [============&gt;.................] - ETA: 1s - loss: 0.0242 - accuracy: 0.9923
 769/1688 [============&gt;.................] - ETA: 1s - loss: 0.0241 - accuracy: 0.9922
 802/1688 [=============&gt;................] - ETA: 1s - loss: 0.0241 - accuracy: 0.9922
 834/1688 [=============&gt;................] - ETA: 1s - loss: 0.0237 - accuracy: 0.9922
 866/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0240 - accuracy: 0.9921
 898/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0239 - accuracy: 0.9920
 929/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0240 - accuracy: 0.9920
 961/1688 [================&gt;.............] - ETA: 1s - loss: 0.0245 - accuracy: 0.9918
 993/1688 [================&gt;.............] - ETA: 1s - loss: 0.0248 - accuracy: 0.9916
1024/1688 [=================&gt;............] - ETA: 1s - loss: 0.0250 - accuracy: 0.9915
1056/1688 [=================&gt;............] - ETA: 1s - loss: 0.0249 - accuracy: 0.9915
1088/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0245 - accuracy: 0.9917
1120/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0246 - accuracy: 0.9917
1152/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0244 - accuracy: 0.9918
1184/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0246 - accuracy: 0.9917
1216/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0249 - accuracy: 0.9915
1247/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0250 - accuracy: 0.9916
1278/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0250 - accuracy: 0.9915
1310/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0252 - accuracy: 0.9915
1341/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0251 - accuracy: 0.9915
1372/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0250 - accuracy: 0.9916
1404/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0251 - accuracy: 0.9916
1435/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0250 - accuracy: 0.9916
1467/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0252 - accuracy: 0.9915
1499/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0251 - accuracy: 0.9915
1532/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0256 - accuracy: 0.9915
1564/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0257 - accuracy: 0.9914
1596/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0256 - accuracy: 0.9914
1628/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0255 - accuracy: 0.9914
1660/1688 [============================&gt;.] - ETA: 0s - loss: 0.0257 - accuracy: 0.9914
1688/1688 [==============================] - 3s 2ms/step - loss: 0.0263 - accuracy: 0.9913 - val_loss: 0.0700 - val_accuracy: 0.9848
Epoch 5/10

   1/1688 [..............................] - ETA: 0s - loss: 0.0494 - accuracy: 0.9688
  35/1688 [..............................] - ETA: 2s - loss: 0.0263 - accuracy: 0.9920
  67/1688 [&gt;.............................] - ETA: 2s - loss: 0.0186 - accuracy: 0.9939
  99/1688 [&gt;.............................] - ETA: 2s - loss: 0.0193 - accuracy: 0.9937
 131/1688 [=&gt;............................] - ETA: 2s - loss: 0.0196 - accuracy: 0.9938
 162/1688 [=&gt;............................] - ETA: 2s - loss: 0.0191 - accuracy: 0.9942
 194/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0183 - accuracy: 0.9947
 226/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0172 - accuracy: 0.9949
 257/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0169 - accuracy: 0.9948
 289/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0190 - accuracy: 0.9942
 321/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0194 - accuracy: 0.9940
 354/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0200 - accuracy: 0.9937
 386/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0198 - accuracy: 0.9935
 418/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0196 - accuracy: 0.9935
 450/1688 [======&gt;.......................] - ETA: 1s - loss: 0.0194 - accuracy: 0.9936
 482/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0192 - accuracy: 0.9936
 515/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0190 - accuracy: 0.9936
 547/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0186 - accuracy: 0.9938
 579/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0187 - accuracy: 0.9936
 610/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0182 - accuracy: 0.9939
 641/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0187 - accuracy: 0.9938
 672/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0189 - accuracy: 0.9937
 704/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0191 - accuracy: 0.9936
 736/1688 [============&gt;.................] - ETA: 1s - loss: 0.0197 - accuracy: 0.9933
 768/1688 [============&gt;.................] - ETA: 1s - loss: 0.0199 - accuracy: 0.9932
 800/1688 [=============&gt;................] - ETA: 1s - loss: 0.0200 - accuracy: 0.9932
 832/1688 [=============&gt;................] - ETA: 1s - loss: 0.0200 - accuracy: 0.9932
 864/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0196 - accuracy: 0.9933
 896/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0197 - accuracy: 0.9933
 928/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0198 - accuracy: 0.9933
 960/1688 [================&gt;.............] - ETA: 1s - loss: 0.0200 - accuracy: 0.9933
 995/1688 [================&gt;.............] - ETA: 1s - loss: 0.0201 - accuracy: 0.9933
1029/1688 [=================&gt;............] - ETA: 1s - loss: 0.0199 - accuracy: 0.9934
1062/1688 [=================&gt;............] - ETA: 0s - loss: 0.0198 - accuracy: 0.9934
1094/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0202 - accuracy: 0.9932
1125/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0200 - accuracy: 0.9932
1157/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0198 - accuracy: 0.9933
1189/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0202 - accuracy: 0.9932
1221/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0200 - accuracy: 0.9932
1253/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0203 - accuracy: 0.9932
1284/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0203 - accuracy: 0.9933
1317/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0208 - accuracy: 0.9932
1350/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0207 - accuracy: 0.9932
1382/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0207 - accuracy: 0.9932
1414/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0206 - accuracy: 0.9932
1446/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0207 - accuracy: 0.9932
1478/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0208 - accuracy: 0.9931
1510/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0207 - accuracy: 0.9932
1542/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0205 - accuracy: 0.9933
1574/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0205 - accuracy: 0.9932
1606/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0206 - accuracy: 0.9933
1638/1688 [============================&gt;.] - ETA: 0s - loss: 0.0206 - accuracy: 0.9932
1669/1688 [============================&gt;.] - ETA: 0s - loss: 0.0206 - accuracy: 0.9932
1688/1688 [==============================] - 3s 2ms/step - loss: 0.0208 - accuracy: 0.9931 - val_loss: 0.0575 - val_accuracy: 0.9853
Epoch 6/10

   1/1688 [..............................] - ETA: 0s - loss: 0.0054 - accuracy: 1.0000
  35/1688 [..............................] - ETA: 2s - loss: 0.0186 - accuracy: 0.9929
  66/1688 [&gt;.............................] - ETA: 2s - loss: 0.0162 - accuracy: 0.9943
  98/1688 [&gt;.............................] - ETA: 2s - loss: 0.0150 - accuracy: 0.9949
 130/1688 [=&gt;............................] - ETA: 2s - loss: 0.0140 - accuracy: 0.9950
 162/1688 [=&gt;............................] - ETA: 2s - loss: 0.0139 - accuracy: 0.9950
 194/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0148 - accuracy: 0.9945
 225/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0152 - accuracy: 0.9943
 256/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0153 - accuracy: 0.9943
 289/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0152 - accuracy: 0.9943
 321/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0143 - accuracy: 0.9946
 353/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0142 - accuracy: 0.9949
 385/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0138 - accuracy: 0.9951
 417/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0138 - accuracy: 0.9953
 449/1688 [======&gt;.......................] - ETA: 1s - loss: 0.0135 - accuracy: 0.9953
 481/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0133 - accuracy: 0.9953
 513/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0129 - accuracy: 0.9954
 545/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0133 - accuracy: 0.9954
 577/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0140 - accuracy: 0.9952
 609/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0142 - accuracy: 0.9952
 641/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0142 - accuracy: 0.9952
 673/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0144 - accuracy: 0.9952
 705/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0143 - accuracy: 0.9953
 737/1688 [============&gt;.................] - ETA: 1s - loss: 0.0146 - accuracy: 0.9951
 770/1688 [============&gt;.................] - ETA: 1s - loss: 0.0148 - accuracy: 0.9950
 802/1688 [=============&gt;................] - ETA: 1s - loss: 0.0144 - accuracy: 0.9952
 834/1688 [=============&gt;................] - ETA: 1s - loss: 0.0143 - accuracy: 0.9952
 867/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0139 - accuracy: 0.9953
 899/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0139 - accuracy: 0.9953
 932/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0137 - accuracy: 0.9954
 963/1688 [================&gt;.............] - ETA: 1s - loss: 0.0134 - accuracy: 0.9956
 995/1688 [================&gt;.............] - ETA: 1s - loss: 0.0133 - accuracy: 0.9956
1027/1688 [=================&gt;............] - ETA: 1s - loss: 0.0134 - accuracy: 0.9956
1060/1688 [=================&gt;............] - ETA: 0s - loss: 0.0133 - accuracy: 0.9956
1092/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0132 - accuracy: 0.9955
1124/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0135 - accuracy: 0.9954
1156/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0144 - accuracy: 0.9952
1188/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0148 - accuracy: 0.9951
1220/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0149 - accuracy: 0.9951
1252/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0148 - accuracy: 0.9951
1284/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0150 - accuracy: 0.9950
1316/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0151 - accuracy: 0.9949
1347/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0155 - accuracy: 0.9948
1379/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0159 - accuracy: 0.9948
1411/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0162 - accuracy: 0.9947
1444/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0162 - accuracy: 0.9947
1476/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0162 - accuracy: 0.9947
1508/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0160 - accuracy: 0.9947
1540/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0158 - accuracy: 0.9948
1573/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0158 - accuracy: 0.9948
1605/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0160 - accuracy: 0.9948
1637/1688 [============================&gt;.] - ETA: 0s - loss: 0.0159 - accuracy: 0.9948
1668/1688 [============================&gt;.] - ETA: 0s - loss: 0.0160 - accuracy: 0.9947
1688/1688 [==============================] - 3s 2ms/step - loss: 0.0161 - accuracy: 0.9947 - val_loss: 0.0512 - val_accuracy: 0.9877
Epoch 7/10

   1/1688 [..............................] - ETA: 0s - loss: 6.6914e-05 - accuracy: 1.0000
  34/1688 [..............................] - ETA: 2s - loss: 0.0103 - accuracy: 0.9963    
  66/1688 [&gt;.............................] - ETA: 2s - loss: 0.0097 - accuracy: 0.9967
  98/1688 [&gt;.............................] - ETA: 2s - loss: 0.0090 - accuracy: 0.9968
 130/1688 [=&gt;............................] - ETA: 2s - loss: 0.0096 - accuracy: 0.9969
 162/1688 [=&gt;............................] - ETA: 2s - loss: 0.0093 - accuracy: 0.9969
 194/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0089 - accuracy: 0.9973
 226/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0093 - accuracy: 0.9970
 258/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0094 - accuracy: 0.9969
 290/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0088 - accuracy: 0.9971
 321/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0086 - accuracy: 0.9972
 353/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0086 - accuracy: 0.9971
 385/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0084 - accuracy: 0.9971
 418/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0084 - accuracy: 0.9972
 450/1688 [======&gt;.......................] - ETA: 1s - loss: 0.0088 - accuracy: 0.9971
 482/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0087 - accuracy: 0.9971
 514/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0091 - accuracy: 0.9970
 546/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0091 - accuracy: 0.9970
 578/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0098 - accuracy: 0.9968
 609/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0101 - accuracy: 0.9968
 641/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0099 - accuracy: 0.9969
 672/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0096 - accuracy: 0.9970
 704/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0097 - accuracy: 0.9970
 736/1688 [============&gt;.................] - ETA: 1s - loss: 0.0096 - accuracy: 0.9971
 767/1688 [============&gt;.................] - ETA: 1s - loss: 0.0099 - accuracy: 0.9969
 799/1688 [=============&gt;................] - ETA: 1s - loss: 0.0098 - accuracy: 0.9969
 831/1688 [=============&gt;................] - ETA: 1s - loss: 0.0098 - accuracy: 0.9970
 862/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0098 - accuracy: 0.9971
 894/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0097 - accuracy: 0.9971
 925/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0096 - accuracy: 0.9970
 957/1688 [================&gt;.............] - ETA: 1s - loss: 0.0094 - accuracy: 0.9971
 989/1688 [================&gt;.............] - ETA: 1s - loss: 0.0094 - accuracy: 0.9972
1021/1688 [=================&gt;............] - ETA: 1s - loss: 0.0094 - accuracy: 0.9972
1053/1688 [=================&gt;............] - ETA: 1s - loss: 0.0097 - accuracy: 0.9971
1085/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0099 - accuracy: 0.9969
1117/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0103 - accuracy: 0.9968
1150/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0105 - accuracy: 0.9968
1182/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0106 - accuracy: 0.9967
1214/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0109 - accuracy: 0.9967
1245/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0112 - accuracy: 0.9965
1276/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0110 - accuracy: 0.9966
1307/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0112 - accuracy: 0.9965
1340/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0115 - accuracy: 0.9963
1372/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0120 - accuracy: 0.9962
1404/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0122 - accuracy: 0.9962
1436/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0127 - accuracy: 0.9961
1468/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0127 - accuracy: 0.9961
1500/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0128 - accuracy: 0.9960
1532/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0126 - accuracy: 0.9961
1564/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0126 - accuracy: 0.9960
1596/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0126 - accuracy: 0.9961
1628/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0128 - accuracy: 0.9960
1660/1688 [============================&gt;.] - ETA: 0s - loss: 0.0130 - accuracy: 0.9959
1688/1688 [==============================] - 3s 2ms/step - loss: 0.0131 - accuracy: 0.9959 - val_loss: 0.0452 - val_accuracy: 0.9890
Epoch 8/10

   1/1688 [..............................] - ETA: 0s - loss: 8.7309e-04 - accuracy: 1.0000
  35/1688 [..............................] - ETA: 2s - loss: 0.0037 - accuracy: 1.0000    
  69/1688 [&gt;.............................] - ETA: 2s - loss: 0.0089 - accuracy: 0.9977
 101/1688 [&gt;.............................] - ETA: 2s - loss: 0.0084 - accuracy: 0.9972
 133/1688 [=&gt;............................] - ETA: 2s - loss: 0.0090 - accuracy: 0.9972
 165/1688 [=&gt;............................] - ETA: 2s - loss: 0.0088 - accuracy: 0.9970
 197/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0081 - accuracy: 0.9971
 229/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0080 - accuracy: 0.9971
 261/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0075 - accuracy: 0.9974
 293/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0077 - accuracy: 0.9974
 324/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0087 - accuracy: 0.9972
 356/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0086 - accuracy: 0.9972
 388/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0083 - accuracy: 0.9972
 420/1688 [======&gt;.......................] - ETA: 1s - loss: 0.0084 - accuracy: 0.9972
 452/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0081 - accuracy: 0.9972
 484/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0080 - accuracy: 0.9973
 515/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0079 - accuracy: 0.9973
 546/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0079 - accuracy: 0.9973
 578/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0082 - accuracy: 0.9971
 610/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0081 - accuracy: 0.9972
 642/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0082 - accuracy: 0.9971
 673/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0083 - accuracy: 0.9970
 705/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0082 - accuracy: 0.9971
 737/1688 [============&gt;.................] - ETA: 1s - loss: 0.0082 - accuracy: 0.9970
 770/1688 [============&gt;.................] - ETA: 1s - loss: 0.0083 - accuracy: 0.9970
 802/1688 [=============&gt;................] - ETA: 1s - loss: 0.0082 - accuracy: 0.9970
 834/1688 [=============&gt;................] - ETA: 1s - loss: 0.0081 - accuracy: 0.9970
 866/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0080 - accuracy: 0.9970
 898/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0081 - accuracy: 0.9970
 931/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0082 - accuracy: 0.9970
 963/1688 [================&gt;.............] - ETA: 1s - loss: 0.0081 - accuracy: 0.9970
 995/1688 [================&gt;.............] - ETA: 1s - loss: 0.0081 - accuracy: 0.9970
1028/1688 [=================&gt;............] - ETA: 1s - loss: 0.0083 - accuracy: 0.9969
1060/1688 [=================&gt;............] - ETA: 0s - loss: 0.0084 - accuracy: 0.9969
1092/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0086 - accuracy: 0.9969
1124/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0091 - accuracy: 0.9967
1155/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0099 - accuracy: 0.9965
1187/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0099 - accuracy: 0.9964
1220/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0099 - accuracy: 0.9964
1252/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0101 - accuracy: 0.9963
1284/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0102 - accuracy: 0.9963
1316/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0105 - accuracy: 0.9962
1348/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0106 - accuracy: 0.9962
1380/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0106 - accuracy: 0.9962
1411/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0105 - accuracy: 0.9961
1443/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0108 - accuracy: 0.9961
1475/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0108 - accuracy: 0.9961
1507/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0109 - accuracy: 0.9960
1539/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0109 - accuracy: 0.9961
1571/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0109 - accuracy: 0.9960
1602/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0109 - accuracy: 0.9960
1634/1688 [============================&gt;.] - ETA: 0s - loss: 0.0115 - accuracy: 0.9959
1665/1688 [============================&gt;.] - ETA: 0s - loss: 0.0116 - accuracy: 0.9959
1688/1688 [==============================] - 3s 2ms/step - loss: 0.0115 - accuracy: 0.9959 - val_loss: 0.0565 - val_accuracy: 0.9875
Epoch 9/10

   1/1688 [..............................] - ETA: 0s - loss: 3.0356e-04 - accuracy: 1.0000
  36/1688 [..............................] - ETA: 2s - loss: 0.0053 - accuracy: 0.9974    
  70/1688 [&gt;.............................] - ETA: 2s - loss: 0.0057 - accuracy: 0.9978
 102/1688 [&gt;.............................] - ETA: 2s - loss: 0.0079 - accuracy: 0.9972
 134/1688 [=&gt;............................] - ETA: 2s - loss: 0.0081 - accuracy: 0.9967
 166/1688 [=&gt;............................] - ETA: 2s - loss: 0.0082 - accuracy: 0.9970
 198/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0076 - accuracy: 0.9972
 229/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0072 - accuracy: 0.9973
 261/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0074 - accuracy: 0.9974
 293/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0076 - accuracy: 0.9972
 326/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0074 - accuracy: 0.9974
 358/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0078 - accuracy: 0.9973
 389/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0083 - accuracy: 0.9972
 421/1688 [======&gt;.......................] - ETA: 1s - loss: 0.0083 - accuracy: 0.9972
 453/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0078 - accuracy: 0.9974
 484/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0077 - accuracy: 0.9974
 516/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0073 - accuracy: 0.9975
 548/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0076 - accuracy: 0.9973
 579/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0078 - accuracy: 0.9971
 612/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0077 - accuracy: 0.9972
 644/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0078 - accuracy: 0.9971
 675/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0080 - accuracy: 0.9971
 707/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0080 - accuracy: 0.9972
 740/1688 [============&gt;.................] - ETA: 1s - loss: 0.0078 - accuracy: 0.9973
 772/1688 [============&gt;.................] - ETA: 1s - loss: 0.0082 - accuracy: 0.9971
 803/1688 [=============&gt;................] - ETA: 1s - loss: 0.0081 - accuracy: 0.9971
 835/1688 [=============&gt;................] - ETA: 1s - loss: 0.0080 - accuracy: 0.9972
 867/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0085 - accuracy: 0.9970
 899/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0084 - accuracy: 0.9970
 931/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0086 - accuracy: 0.9969
 963/1688 [================&gt;.............] - ETA: 1s - loss: 0.0090 - accuracy: 0.9968
 995/1688 [================&gt;.............] - ETA: 1s - loss: 0.0090 - accuracy: 0.9969
1027/1688 [=================&gt;............] - ETA: 1s - loss: 0.0091 - accuracy: 0.9968
1059/1688 [=================&gt;............] - ETA: 0s - loss: 0.0091 - accuracy: 0.9968
1090/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0091 - accuracy: 0.9968
1122/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0092 - accuracy: 0.9969
1154/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0093 - accuracy: 0.9968
1185/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0095 - accuracy: 0.9967
1218/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0098 - accuracy: 0.9966
1249/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0100 - accuracy: 0.9965
1281/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0100 - accuracy: 0.9965
1312/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0100 - accuracy: 0.9965
1343/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0100 - accuracy: 0.9965
1374/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0101 - accuracy: 0.9965
1406/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0100 - accuracy: 0.9966
1438/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0100 - accuracy: 0.9966
1470/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0101 - accuracy: 0.9966
1502/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0102 - accuracy: 0.9965
1533/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0101 - accuracy: 0.9966
1565/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0101 - accuracy: 0.9966
1597/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0103 - accuracy: 0.9965
1629/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0104 - accuracy: 0.9965
1661/1688 [============================&gt;.] - ETA: 0s - loss: 0.0105 - accuracy: 0.9964
1688/1688 [==============================] - 3s 2ms/step - loss: 0.0104 - accuracy: 0.9964 - val_loss: 0.0549 - val_accuracy: 0.9880
Epoch 10/10

   1/1688 [..............................] - ETA: 0s - loss: 0.0767 - accuracy: 0.9688
  35/1688 [..............................] - ETA: 2s - loss: 0.0063 - accuracy: 0.9973
  67/1688 [&gt;.............................] - ETA: 2s - loss: 0.0089 - accuracy: 0.9977
  99/1688 [&gt;.............................] - ETA: 2s - loss: 0.0072 - accuracy: 0.9978
 131/1688 [=&gt;............................] - ETA: 2s - loss: 0.0065 - accuracy: 0.9979
 163/1688 [=&gt;............................] - ETA: 2s - loss: 0.0062 - accuracy: 0.9979
 195/1688 [==&gt;...........................] - ETA: 2s - loss: 0.0060 - accuracy: 0.9978
 227/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0060 - accuracy: 0.9978
 258/1688 [===&gt;..........................] - ETA: 2s - loss: 0.0056 - accuracy: 0.9981
 290/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0051 - accuracy: 0.9983
 322/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0052 - accuracy: 0.9983
 355/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0057 - accuracy: 0.9982
 387/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0057 - accuracy: 0.9981
 419/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0055 - accuracy: 0.9983
 451/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0055 - accuracy: 0.9983
 483/1688 [=======&gt;......................] - ETA: 1s - loss: 0.0054 - accuracy: 0.9983
 515/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0053 - accuracy: 0.9984
 547/1688 [========&gt;.....................] - ETA: 1s - loss: 0.0054 - accuracy: 0.9983
 578/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0054 - accuracy: 0.9983
 611/1688 [=========&gt;....................] - ETA: 1s - loss: 0.0054 - accuracy: 0.9984
 643/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0056 - accuracy: 0.9983
 675/1688 [==========&gt;...................] - ETA: 1s - loss: 0.0056 - accuracy: 0.9983
 707/1688 [===========&gt;..................] - ETA: 1s - loss: 0.0056 - accuracy: 0.9982
 739/1688 [============&gt;.................] - ETA: 1s - loss: 0.0055 - accuracy: 0.9983
 770/1688 [============&gt;.................] - ETA: 1s - loss: 0.0054 - accuracy: 0.9983
 802/1688 [=============&gt;................] - ETA: 1s - loss: 0.0056 - accuracy: 0.9982
 834/1688 [=============&gt;................] - ETA: 1s - loss: 0.0056 - accuracy: 0.9981
 867/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0059 - accuracy: 0.9981
 899/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0065 - accuracy: 0.9978
 931/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0070 - accuracy: 0.9977
 963/1688 [================&gt;.............] - ETA: 1s - loss: 0.0073 - accuracy: 0.9976
 995/1688 [================&gt;.............] - ETA: 1s - loss: 0.0073 - accuracy: 0.9976
1028/1688 [=================&gt;............] - ETA: 1s - loss: 0.0074 - accuracy: 0.9975
1061/1688 [=================&gt;............] - ETA: 0s - loss: 0.0074 - accuracy: 0.9976
1094/1688 [==================&gt;...........] - ETA: 0s - loss: 0.0073 - accuracy: 0.9976
1126/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0073 - accuracy: 0.9976
1157/1688 [===================&gt;..........] - ETA: 0s - loss: 0.0073 - accuracy: 0.9975
1189/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0072 - accuracy: 0.9975
1220/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0071 - accuracy: 0.9976
1251/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0071 - accuracy: 0.9976
1283/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0070 - accuracy: 0.9976
1314/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0071 - accuracy: 0.9976
1346/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0072 - accuracy: 0.9975
1378/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0074 - accuracy: 0.9974
1410/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0076 - accuracy: 0.9974
1442/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0078 - accuracy: 0.9973
1475/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0083 - accuracy: 0.9972
1509/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0083 - accuracy: 0.9971
1540/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0086 - accuracy: 0.9971
1573/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0088 - accuracy: 0.9970
1605/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0088 - accuracy: 0.9970
1637/1688 [============================&gt;.] - ETA: 0s - loss: 0.0089 - accuracy: 0.9970
1669/1688 [============================&gt;.] - ETA: 0s - loss: 0.0088 - accuracy: 0.9970
1688/1688 [==============================] - 3s 2ms/step - loss: 0.0087 - accuracy: 0.9970 - val_loss: 0.0446 - val_accuracy: 0.9918
Test score: 0.04318632185459137
Test accuracy: 0.9894999861717224
</pre></div>
</div>
</div>
</div>
<div class="section" id="model-quantization">
<h2>4. Model quantization<a class="headerlink" href="#model-quantization" title="Permalink to this headline">¶</a></h2>
<p>We can now turn to quantization to get a discretized version of the model,
where the weights and activations are quantized so as to be suitable for
implementation in the Akida NSoC.</p>
<p>For this, we just have to quantize the Keras model using the
<a class="reference external" href="../api_reference/cnn2snn_apis.html#quantize">quantize</a>
function. Here, we decide to quantize to the maximum allowed bitwidths for
the first layer weights (8-bit), the subsequent layer weights (4-bit) and the
activations (4-bit).</p>
<p>The quantized model is a Keras model where the neural layers (Conv2D, Dense)
and the ReLU layers are replaced with custom CNN2SNN quantized layers
(QuantizedConv2D, QuantizedDense, QuantizedReLU). All Keras API functions
can be applied on this new model: <code class="docutils literal notranslate"><span class="pre">summary()</span></code>, <code class="docutils literal notranslate"><span class="pre">compile()</span></code>, <code class="docutils literal notranslate"><span class="pre">fit()</span></code>. etc.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">quantize</span></code> function folds the batch normalization layers into
the corresponding neural layer. The new weights are computed
according to this folding operation.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cnn2snn</span> <span class="kn">import</span> <span class="n">quantize</span>

<span class="n">model_quantized</span> <span class="o">=</span> <span class="n">quantize</span><span class="p">(</span><span class="n">model_keras</span><span class="p">,</span>
                           <span class="n">input_weight_quantization</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                           <span class="n">weight_quantization</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                           <span class="n">activ_quantization</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">model_quantized</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Model: &quot;mnistnet&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
input_2 (InputLayer)         [(None, 28, 28, 1)]       0
_________________________________________________________________
conv2d (QuantizedConv2D)     (None, 26, 26, 32)        320
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 13, 13, 32)        0
_________________________________________________________________
re_lu (ActivationDiscreteRel (None, 13, 13, 32)        0
_________________________________________________________________
separable_conv2d (QuantizedS (None, 13, 13, 64)        2400
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 7, 7, 64)          0
_________________________________________________________________
re_lu_1 (ActivationDiscreteR (None, 7, 7, 64)          0
_________________________________________________________________
flatten (Flatten)            (None, 3136)              0
_________________________________________________________________
dense (QuantizedDense)       (None, 10)                31370
=================================================================
Total params: 34,090
Trainable params: 34,090
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
<p>Check the quantized model accuracy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_quantized</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

<span class="n">score</span> <span class="o">=</span> <span class="n">model_quantized</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test accuracy after 8-4-4 quantization:&#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Test accuracy after 8-4-4 quantization: 0.9887999892234802
</pre></div>
</div>
<p>Since we used the maximum allowed bitwidths for weights and activations, the
accuracy of the quantized model is equivalent to the one of the base model,
but for lower bitwidth, the quantization  usually introduces a performance drop.</p>
<p>Let’s try to quantize specific layers to a lower bitwidth. The CNN2SNN
toolkit provides the
<a class="reference external" href="../api_reference/cnn2snn_apis.html#quantize_layer">quantize_layer</a>
function: each layer can be individually quantized.</p>
<p>Here, we quantize the “re_lu_1” layer to binary activations (bitwidth=1)
and the “dense” layer with 2-bit weights.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cnn2snn</span> <span class="kn">import</span> <span class="n">quantize_layer</span>

<span class="n">model_quantized</span> <span class="o">=</span> <span class="n">quantize_layer</span><span class="p">(</span><span class="n">model_quantized</span><span class="p">,</span> <span class="s2">&quot;re_lu_1&quot;</span><span class="p">,</span> <span class="n">bitwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model_quantized</span> <span class="o">=</span> <span class="n">quantize_layer</span><span class="p">(</span><span class="n">model_quantized</span><span class="p">,</span> <span class="s2">&quot;dense&quot;</span><span class="p">,</span> <span class="n">bitwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">model_quantized</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(</span><span class="n">from_logits</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

<span class="n">score</span> <span class="o">=</span> <span class="n">model_quantized</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test accuracy after low bitwidth quantization:&#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># To recover the original model accuracy, a quantization-aware training phase</span>
<span class="c1"># is required.</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Test accuracy after low bitwidth quantization: 0.7328000068664551
</pre></div>
</div>
</div>
<div class="section" id="model-fine-tuning-quantization-aware-training">
<h2>5. Model fine tuning (quantization-aware training)<a class="headerlink" href="#model-fine-tuning-quantization-aware-training" title="Permalink to this headline">¶</a></h2>
<p>This quantization-aware training (fine tuning) allows to cover the
performance drop due to the quantization step.</p>
<p>Note that since this step is a fine tuning, the number of epochs can be
lowered, compared to the training from scratch of the standard model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_quantized</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">score</span> <span class="o">=</span> <span class="n">model_quantized</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test accuracy after fine tuning:&#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Epoch 1/5

   1/1688 [..............................] - ETA: 0s - loss: 0.7910 - accuracy: 0.6875
  24/1688 [..............................] - ETA: 3s - loss: 0.4013 - accuracy: 0.8685
  48/1688 [..............................] - ETA: 3s - loss: 0.3105 - accuracy: 0.9036
  71/1688 [&gt;.............................] - ETA: 3s - loss: 0.2597 - accuracy: 0.9190
  94/1688 [&gt;.............................] - ETA: 3s - loss: 0.2224 - accuracy: 0.9318
 118/1688 [=&gt;............................] - ETA: 3s - loss: 0.1937 - accuracy: 0.9412
 142/1688 [=&gt;............................] - ETA: 3s - loss: 0.1709 - accuracy: 0.9481
 165/1688 [=&gt;............................] - ETA: 3s - loss: 0.1563 - accuracy: 0.9525
 188/1688 [==&gt;...........................] - ETA: 3s - loss: 0.1477 - accuracy: 0.9545
 211/1688 [==&gt;...........................] - ETA: 3s - loss: 0.1383 - accuracy: 0.9570
 235/1688 [===&gt;..........................] - ETA: 3s - loss: 0.1296 - accuracy: 0.9597
 259/1688 [===&gt;..........................] - ETA: 3s - loss: 0.1238 - accuracy: 0.9613
 283/1688 [====&gt;.........................] - ETA: 3s - loss: 0.1173 - accuracy: 0.9631
 306/1688 [====&gt;.........................] - ETA: 3s - loss: 0.1118 - accuracy: 0.9649
 330/1688 [====&gt;.........................] - ETA: 2s - loss: 0.1083 - accuracy: 0.9656
 353/1688 [=====&gt;........................] - ETA: 2s - loss: 0.1035 - accuracy: 0.9672
 377/1688 [=====&gt;........................] - ETA: 2s - loss: 0.1002 - accuracy: 0.9683
 401/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0963 - accuracy: 0.9693
 425/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0943 - accuracy: 0.9699
 448/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0912 - accuracy: 0.9708
 472/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0889 - accuracy: 0.9713
 495/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0865 - accuracy: 0.9721
 519/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0847 - accuracy: 0.9728
 543/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0826 - accuracy: 0.9734
 566/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0804 - accuracy: 0.9742
 590/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0788 - accuracy: 0.9746
 614/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0770 - accuracy: 0.9752
 638/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0753 - accuracy: 0.9757
 661/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0743 - accuracy: 0.9760
 684/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0727 - accuracy: 0.9765
 708/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0714 - accuracy: 0.9769
 733/1688 [============&gt;.................] - ETA: 2s - loss: 0.0707 - accuracy: 0.9771
 757/1688 [============&gt;.................] - ETA: 2s - loss: 0.0698 - accuracy: 0.9773
 781/1688 [============&gt;.................] - ETA: 1s - loss: 0.0683 - accuracy: 0.9778
 804/1688 [=============&gt;................] - ETA: 1s - loss: 0.0671 - accuracy: 0.9781
 827/1688 [=============&gt;................] - ETA: 1s - loss: 0.0665 - accuracy: 0.9783
 850/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0653 - accuracy: 0.9787
 873/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0649 - accuracy: 0.9787
 896/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0650 - accuracy: 0.9787
 920/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0643 - accuracy: 0.9790
 944/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0639 - accuracy: 0.9791
 967/1688 [================&gt;.............] - ETA: 1s - loss: 0.0630 - accuracy: 0.9794
 991/1688 [================&gt;.............] - ETA: 1s - loss: 0.0626 - accuracy: 0.9795
1014/1688 [=================&gt;............] - ETA: 1s - loss: 0.0623 - accuracy: 0.9796
1038/1688 [=================&gt;............] - ETA: 1s - loss: 0.0615 - accuracy: 0.9798
1062/1688 [=================&gt;............] - ETA: 1s - loss: 0.0605 - accuracy: 0.9802
1085/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0601 - accuracy: 0.9804
1108/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0593 - accuracy: 0.9808
1130/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0588 - accuracy: 0.9809
1154/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0582 - accuracy: 0.9812
1178/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0575 - accuracy: 0.9814
1202/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0571 - accuracy: 0.9815
1225/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0566 - accuracy: 0.9816
1248/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0565 - accuracy: 0.9815
1271/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0562 - accuracy: 0.9816
1295/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0555 - accuracy: 0.9818
1318/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0551 - accuracy: 0.9820
1342/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0552 - accuracy: 0.9820
1366/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0549 - accuracy: 0.9820
1390/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0546 - accuracy: 0.9821
1414/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0541 - accuracy: 0.9822
1438/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0540 - accuracy: 0.9822
1462/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0537 - accuracy: 0.9823
1486/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0530 - accuracy: 0.9825
1509/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0529 - accuracy: 0.9825
1533/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0527 - accuracy: 0.9826
1557/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0525 - accuracy: 0.9826
1581/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0525 - accuracy: 0.9827
1604/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0523 - accuracy: 0.9827
1628/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0519 - accuracy: 0.9828
1652/1688 [============================&gt;.] - ETA: 0s - loss: 0.0516 - accuracy: 0.9829
1675/1688 [============================&gt;.] - ETA: 0s - loss: 0.0514 - accuracy: 0.9830
1688/1688 [==============================] - 4s 2ms/step - loss: 0.0512 - accuracy: 0.9830 - val_loss: 0.0558 - val_accuracy: 0.9862
Epoch 2/5

   1/1688 [..............................] - ETA: 0s - loss: 0.0151 - accuracy: 1.0000
  26/1688 [..............................] - ETA: 3s - loss: 0.0158 - accuracy: 0.9940
  50/1688 [..............................] - ETA: 3s - loss: 0.0164 - accuracy: 0.9950
  74/1688 [&gt;.............................] - ETA: 3s - loss: 0.0176 - accuracy: 0.9945
  98/1688 [&gt;.............................] - ETA: 3s - loss: 0.0205 - accuracy: 0.9927
 121/1688 [=&gt;............................] - ETA: 3s - loss: 0.0199 - accuracy: 0.9928
 144/1688 [=&gt;............................] - ETA: 3s - loss: 0.0214 - accuracy: 0.9928
 168/1688 [=&gt;............................] - ETA: 3s - loss: 0.0245 - accuracy: 0.9911
 192/1688 [==&gt;...........................] - ETA: 3s - loss: 0.0239 - accuracy: 0.9910
 216/1688 [==&gt;...........................] - ETA: 3s - loss: 0.0243 - accuracy: 0.9912
 239/1688 [===&gt;..........................] - ETA: 3s - loss: 0.0262 - accuracy: 0.9906
 262/1688 [===&gt;..........................] - ETA: 3s - loss: 0.0264 - accuracy: 0.9905
 286/1688 [====&gt;.........................] - ETA: 3s - loss: 0.0271 - accuracy: 0.9902
 310/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0262 - accuracy: 0.9903
 334/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0265 - accuracy: 0.9906
 358/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0259 - accuracy: 0.9908
 382/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0266 - accuracy: 0.9907
 406/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0265 - accuracy: 0.9906
 430/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0258 - accuracy: 0.9909
 454/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0255 - accuracy: 0.9909
 478/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0252 - accuracy: 0.9909
 501/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0248 - accuracy: 0.9911
 525/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0244 - accuracy: 0.9914
 549/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0243 - accuracy: 0.9914
 573/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0249 - accuracy: 0.9912
 597/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0253 - accuracy: 0.9909
 620/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0251 - accuracy: 0.9910
 643/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0248 - accuracy: 0.9911
 667/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0253 - accuracy: 0.9909
 691/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0256 - accuracy: 0.9907
 714/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0267 - accuracy: 0.9904
 738/1688 [============&gt;.................] - ETA: 2s - loss: 0.0267 - accuracy: 0.9905
 761/1688 [============&gt;.................] - ETA: 2s - loss: 0.0267 - accuracy: 0.9906
 784/1688 [============&gt;.................] - ETA: 1s - loss: 0.0272 - accuracy: 0.9905
 808/1688 [=============&gt;................] - ETA: 1s - loss: 0.0271 - accuracy: 0.9905
 832/1688 [=============&gt;................] - ETA: 1s - loss: 0.0270 - accuracy: 0.9905
 855/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0267 - accuracy: 0.9907
 878/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0266 - accuracy: 0.9907
 902/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0266 - accuracy: 0.9907
 926/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0263 - accuracy: 0.9908
 950/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0265 - accuracy: 0.9908
 974/1688 [================&gt;.............] - ETA: 1s - loss: 0.0272 - accuracy: 0.9906
 998/1688 [================&gt;.............] - ETA: 1s - loss: 0.0269 - accuracy: 0.9907
1022/1688 [=================&gt;............] - ETA: 1s - loss: 0.0273 - accuracy: 0.9906
1046/1688 [=================&gt;............] - ETA: 1s - loss: 0.0272 - accuracy: 0.9906
1070/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0269 - accuracy: 0.9907
1093/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0267 - accuracy: 0.9908
1117/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0269 - accuracy: 0.9907
1141/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0277 - accuracy: 0.9904
1164/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0277 - accuracy: 0.9904
1187/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0276 - accuracy: 0.9903
1211/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0275 - accuracy: 0.9903
1235/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0276 - accuracy: 0.9903
1259/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0277 - accuracy: 0.9903
1282/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0277 - accuracy: 0.9902
1306/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0277 - accuracy: 0.9902
1330/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0277 - accuracy: 0.9903
1354/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0277 - accuracy: 0.9903
1377/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0276 - accuracy: 0.9903
1400/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0274 - accuracy: 0.9903
1424/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0275 - accuracy: 0.9903
1448/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0277 - accuracy: 0.9903
1472/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0280 - accuracy: 0.9903
1496/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0282 - accuracy: 0.9902
1519/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0285 - accuracy: 0.9901
1543/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0286 - accuracy: 0.9901
1566/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0286 - accuracy: 0.9901
1590/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0286 - accuracy: 0.9901
1613/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0286 - accuracy: 0.9901
1637/1688 [============================&gt;.] - ETA: 0s - loss: 0.0286 - accuracy: 0.9901
1661/1688 [============================&gt;.] - ETA: 0s - loss: 0.0284 - accuracy: 0.9901
1685/1688 [============================&gt;.] - ETA: 0s - loss: 0.0282 - accuracy: 0.9902
1688/1688 [==============================] - 4s 2ms/step - loss: 0.0282 - accuracy: 0.9901 - val_loss: 0.0492 - val_accuracy: 0.9885
Epoch 3/5

   1/1688 [..............................] - ETA: 0s - loss: 0.0569 - accuracy: 0.9688
  24/1688 [..............................] - ETA: 3s - loss: 0.0349 - accuracy: 0.9870
  48/1688 [..............................] - ETA: 3s - loss: 0.0230 - accuracy: 0.9909
  71/1688 [&gt;.............................] - ETA: 3s - loss: 0.0206 - accuracy: 0.9925
  95/1688 [&gt;.............................] - ETA: 3s - loss: 0.0217 - accuracy: 0.9931
 118/1688 [=&gt;............................] - ETA: 3s - loss: 0.0205 - accuracy: 0.9931
 142/1688 [=&gt;............................] - ETA: 3s - loss: 0.0191 - accuracy: 0.9938
 165/1688 [=&gt;............................] - ETA: 3s - loss: 0.0196 - accuracy: 0.9937
 188/1688 [==&gt;...........................] - ETA: 3s - loss: 0.0191 - accuracy: 0.9940
 212/1688 [==&gt;...........................] - ETA: 3s - loss: 0.0186 - accuracy: 0.9943
 236/1688 [===&gt;..........................] - ETA: 3s - loss: 0.0185 - accuracy: 0.9939
 260/1688 [===&gt;..........................] - ETA: 3s - loss: 0.0186 - accuracy: 0.9937
 284/1688 [====&gt;.........................] - ETA: 3s - loss: 0.0192 - accuracy: 0.9934
 307/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0203 - accuracy: 0.9932
 331/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0204 - accuracy: 0.9931
 355/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0202 - accuracy: 0.9932
 379/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0215 - accuracy: 0.9928
 402/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0208 - accuracy: 0.9932
 425/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0204 - accuracy: 0.9933
 449/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0202 - accuracy: 0.9932
 473/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0201 - accuracy: 0.9932
 497/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0204 - accuracy: 0.9932
 520/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0204 - accuracy: 0.9931
 544/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0202 - accuracy: 0.9932
 568/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0206 - accuracy: 0.9932
 591/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0206 - accuracy: 0.9930
 615/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0204 - accuracy: 0.9931
 638/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0202 - accuracy: 0.9932
 662/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0209 - accuracy: 0.9930
 685/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0208 - accuracy: 0.9929
 709/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0212 - accuracy: 0.9927
 733/1688 [============&gt;.................] - ETA: 2s - loss: 0.0213 - accuracy: 0.9927
 757/1688 [============&gt;.................] - ETA: 2s - loss: 0.0210 - accuracy: 0.9928
 781/1688 [============&gt;.................] - ETA: 1s - loss: 0.0213 - accuracy: 0.9927
 805/1688 [=============&gt;................] - ETA: 1s - loss: 0.0217 - accuracy: 0.9926
 829/1688 [=============&gt;................] - ETA: 1s - loss: 0.0220 - accuracy: 0.9925
 853/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0222 - accuracy: 0.9925
 877/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0221 - accuracy: 0.9924
 901/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0218 - accuracy: 0.9925
 925/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0222 - accuracy: 0.9924
 949/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0224 - accuracy: 0.9923
 972/1688 [================&gt;.............] - ETA: 1s - loss: 0.0229 - accuracy: 0.9922
 996/1688 [================&gt;.............] - ETA: 1s - loss: 0.0230 - accuracy: 0.9922
1019/1688 [=================&gt;............] - ETA: 1s - loss: 0.0228 - accuracy: 0.9922
1042/1688 [=================&gt;............] - ETA: 1s - loss: 0.0232 - accuracy: 0.9922
1066/1688 [=================&gt;............] - ETA: 1s - loss: 0.0232 - accuracy: 0.9921
1090/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0233 - accuracy: 0.9920
1114/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0235 - accuracy: 0.9920
1138/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0233 - accuracy: 0.9921
1161/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0231 - accuracy: 0.9922
1185/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0232 - accuracy: 0.9920
1208/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0232 - accuracy: 0.9920
1232/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0234 - accuracy: 0.9919
1255/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0232 - accuracy: 0.9919
1279/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0236 - accuracy: 0.9918
1303/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0235 - accuracy: 0.9918
1326/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0234 - accuracy: 0.9919
1349/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0233 - accuracy: 0.9919
1373/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0234 - accuracy: 0.9919
1397/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0236 - accuracy: 0.9919
1421/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0235 - accuracy: 0.9918
1444/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0234 - accuracy: 0.9919
1468/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0235 - accuracy: 0.9920
1491/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0233 - accuracy: 0.9920
1515/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0232 - accuracy: 0.9921
1539/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0231 - accuracy: 0.9921
1563/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0236 - accuracy: 0.9919
1587/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0236 - accuracy: 0.9918
1611/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0236 - accuracy: 0.9918
1635/1688 [============================&gt;.] - ETA: 0s - loss: 0.0236 - accuracy: 0.9918
1659/1688 [============================&gt;.] - ETA: 0s - loss: 0.0237 - accuracy: 0.9917
1683/1688 [============================&gt;.] - ETA: 0s - loss: 0.0235 - accuracy: 0.9918
1688/1688 [==============================] - 4s 2ms/step - loss: 0.0235 - accuracy: 0.9918 - val_loss: 0.0463 - val_accuracy: 0.9887
Epoch 4/5

   1/1688 [..............................] - ETA: 0s - loss: 0.0014 - accuracy: 1.0000
  25/1688 [..............................] - ETA: 3s - loss: 0.0079 - accuracy: 0.9975
  49/1688 [..............................] - ETA: 3s - loss: 0.0101 - accuracy: 0.9968
  74/1688 [&gt;.............................] - ETA: 3s - loss: 0.0108 - accuracy: 0.9966
  98/1688 [&gt;.............................] - ETA: 3s - loss: 0.0147 - accuracy: 0.9955
 121/1688 [=&gt;............................] - ETA: 3s - loss: 0.0156 - accuracy: 0.9954
 145/1688 [=&gt;............................] - ETA: 3s - loss: 0.0165 - accuracy: 0.9948
 169/1688 [==&gt;...........................] - ETA: 3s - loss: 0.0160 - accuracy: 0.9950
 193/1688 [==&gt;...........................] - ETA: 3s - loss: 0.0173 - accuracy: 0.9945
 217/1688 [==&gt;...........................] - ETA: 3s - loss: 0.0169 - accuracy: 0.9944
 241/1688 [===&gt;..........................] - ETA: 3s - loss: 0.0164 - accuracy: 0.9946
 265/1688 [===&gt;..........................] - ETA: 3s - loss: 0.0158 - accuracy: 0.9946
 289/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0152 - accuracy: 0.9947
 312/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0155 - accuracy: 0.9944
 336/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0158 - accuracy: 0.9942
 359/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0151 - accuracy: 0.9945
 383/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0148 - accuracy: 0.9946
 407/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0152 - accuracy: 0.9945
 431/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0152 - accuracy: 0.9945
 454/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0159 - accuracy: 0.9944
 478/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0165 - accuracy: 0.9941
 502/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0165 - accuracy: 0.9940
 526/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0163 - accuracy: 0.9941
 550/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0164 - accuracy: 0.9940
 574/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0165 - accuracy: 0.9940
 598/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0169 - accuracy: 0.9940
 622/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0170 - accuracy: 0.9940
 646/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0170 - accuracy: 0.9940
 670/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0177 - accuracy: 0.9939
 694/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0179 - accuracy: 0.9939
 717/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0178 - accuracy: 0.9939
 741/1688 [============&gt;.................] - ETA: 2s - loss: 0.0181 - accuracy: 0.9938
 765/1688 [============&gt;.................] - ETA: 1s - loss: 0.0182 - accuracy: 0.9937
 789/1688 [=============&gt;................] - ETA: 1s - loss: 0.0181 - accuracy: 0.9937
 813/1688 [=============&gt;................] - ETA: 1s - loss: 0.0184 - accuracy: 0.9937
 837/1688 [=============&gt;................] - ETA: 1s - loss: 0.0182 - accuracy: 0.9937
 861/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0184 - accuracy: 0.9936
 884/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0185 - accuracy: 0.9935
 908/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0185 - accuracy: 0.9936
 931/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0186 - accuracy: 0.9936
 954/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0189 - accuracy: 0.9935
 977/1688 [================&gt;.............] - ETA: 1s - loss: 0.0190 - accuracy: 0.9934
1001/1688 [================&gt;.............] - ETA: 1s - loss: 0.0190 - accuracy: 0.9934
1025/1688 [=================&gt;............] - ETA: 1s - loss: 0.0195 - accuracy: 0.9933
1049/1688 [=================&gt;............] - ETA: 1s - loss: 0.0199 - accuracy: 0.9934
1073/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0200 - accuracy: 0.9933
1097/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0198 - accuracy: 0.9934
1121/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0202 - accuracy: 0.9933
1145/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0201 - accuracy: 0.9933
1169/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0201 - accuracy: 0.9933
1192/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0202 - accuracy: 0.9933
1216/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0206 - accuracy: 0.9931
1240/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0204 - accuracy: 0.9931
1264/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0205 - accuracy: 0.9932
1288/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0206 - accuracy: 0.9931
1311/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0206 - accuracy: 0.9931
1334/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0208 - accuracy: 0.9930
1357/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0208 - accuracy: 0.9930
1381/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0206 - accuracy: 0.9931
1405/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0204 - accuracy: 0.9931
1429/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0205 - accuracy: 0.9931
1452/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0204 - accuracy: 0.9932
1476/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0203 - accuracy: 0.9932
1500/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0203 - accuracy: 0.9932
1524/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0205 - accuracy: 0.9931
1547/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0208 - accuracy: 0.9930
1571/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0207 - accuracy: 0.9930
1594/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0207 - accuracy: 0.9930
1618/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0207 - accuracy: 0.9930
1641/1688 [============================&gt;.] - ETA: 0s - loss: 0.0208 - accuracy: 0.9930
1665/1688 [============================&gt;.] - ETA: 0s - loss: 0.0209 - accuracy: 0.9929
1688/1688 [==============================] - 4s 2ms/step - loss: 0.0209 - accuracy: 0.9929 - val_loss: 0.0503 - val_accuracy: 0.9873
Epoch 5/5

   1/1688 [..............................] - ETA: 0s - loss: 0.0133 - accuracy: 1.0000
  25/1688 [..............................] - ETA: 3s - loss: 0.0263 - accuracy: 0.9912
  48/1688 [..............................] - ETA: 3s - loss: 0.0199 - accuracy: 0.9935
  72/1688 [&gt;.............................] - ETA: 3s - loss: 0.0182 - accuracy: 0.9944
  96/1688 [&gt;.............................] - ETA: 3s - loss: 0.0187 - accuracy: 0.9938
 119/1688 [=&gt;............................] - ETA: 3s - loss: 0.0191 - accuracy: 0.9934
 143/1688 [=&gt;............................] - ETA: 3s - loss: 0.0208 - accuracy: 0.9928
 166/1688 [=&gt;............................] - ETA: 3s - loss: 0.0208 - accuracy: 0.9925
 190/1688 [==&gt;...........................] - ETA: 3s - loss: 0.0206 - accuracy: 0.9926
 214/1688 [==&gt;...........................] - ETA: 3s - loss: 0.0193 - accuracy: 0.9931
 238/1688 [===&gt;..........................] - ETA: 3s - loss: 0.0192 - accuracy: 0.9932
 262/1688 [===&gt;..........................] - ETA: 3s - loss: 0.0205 - accuracy: 0.9930
 286/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0208 - accuracy: 0.9928
 309/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0197 - accuracy: 0.9932
 333/1688 [====&gt;.........................] - ETA: 2s - loss: 0.0187 - accuracy: 0.9937
 357/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0185 - accuracy: 0.9937
 380/1688 [=====&gt;........................] - ETA: 2s - loss: 0.0180 - accuracy: 0.9939
 404/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0179 - accuracy: 0.9939
 427/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0177 - accuracy: 0.9941
 450/1688 [======&gt;.......................] - ETA: 2s - loss: 0.0181 - accuracy: 0.9942
 474/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0186 - accuracy: 0.9941
 497/1688 [=======&gt;......................] - ETA: 2s - loss: 0.0186 - accuracy: 0.9940
 521/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0184 - accuracy: 0.9941
 545/1688 [========&gt;.....................] - ETA: 2s - loss: 0.0181 - accuracy: 0.9942
 568/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0181 - accuracy: 0.9942
 592/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0181 - accuracy: 0.9942
 616/1688 [=========&gt;....................] - ETA: 2s - loss: 0.0178 - accuracy: 0.9942
 639/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0177 - accuracy: 0.9941
 663/1688 [==========&gt;...................] - ETA: 2s - loss: 0.0181 - accuracy: 0.9940
 687/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0179 - accuracy: 0.9940
 711/1688 [===========&gt;..................] - ETA: 2s - loss: 0.0176 - accuracy: 0.9942
 735/1688 [============&gt;.................] - ETA: 2s - loss: 0.0177 - accuracy: 0.9943
 759/1688 [============&gt;.................] - ETA: 2s - loss: 0.0180 - accuracy: 0.9940
 783/1688 [============&gt;.................] - ETA: 1s - loss: 0.0181 - accuracy: 0.9941
 807/1688 [=============&gt;................] - ETA: 1s - loss: 0.0184 - accuracy: 0.9940
 831/1688 [=============&gt;................] - ETA: 1s - loss: 0.0187 - accuracy: 0.9939
 854/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0184 - accuracy: 0.9939
 878/1688 [==============&gt;...............] - ETA: 1s - loss: 0.0183 - accuracy: 0.9938
 901/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0186 - accuracy: 0.9938
 924/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0189 - accuracy: 0.9937
 948/1688 [===============&gt;..............] - ETA: 1s - loss: 0.0187 - accuracy: 0.9938
 972/1688 [================&gt;.............] - ETA: 1s - loss: 0.0185 - accuracy: 0.9939
 996/1688 [================&gt;.............] - ETA: 1s - loss: 0.0183 - accuracy: 0.9939
1019/1688 [=================&gt;............] - ETA: 1s - loss: 0.0183 - accuracy: 0.9940
1043/1688 [=================&gt;............] - ETA: 1s - loss: 0.0184 - accuracy: 0.9939
1066/1688 [=================&gt;............] - ETA: 1s - loss: 0.0183 - accuracy: 0.9940
1090/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0184 - accuracy: 0.9939
1114/1688 [==================&gt;...........] - ETA: 1s - loss: 0.0187 - accuracy: 0.9938
1138/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0185 - accuracy: 0.9938
1162/1688 [===================&gt;..........] - ETA: 1s - loss: 0.0190 - accuracy: 0.9938
1186/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0189 - accuracy: 0.9938
1209/1688 [====================&gt;.........] - ETA: 1s - loss: 0.0188 - accuracy: 0.9938
1232/1688 [====================&gt;.........] - ETA: 0s - loss: 0.0193 - accuracy: 0.9937
1256/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0195 - accuracy: 0.9936
1279/1688 [=====================&gt;........] - ETA: 0s - loss: 0.0196 - accuracy: 0.9936
1302/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0196 - accuracy: 0.9935
1326/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0195 - accuracy: 0.9935
1349/1688 [======================&gt;.......] - ETA: 0s - loss: 0.0193 - accuracy: 0.9936
1372/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0192 - accuracy: 0.9936
1396/1688 [=======================&gt;......] - ETA: 0s - loss: 0.0193 - accuracy: 0.9936
1420/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0193 - accuracy: 0.9935
1443/1688 [========================&gt;.....] - ETA: 0s - loss: 0.0192 - accuracy: 0.9935
1466/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0190 - accuracy: 0.9936
1489/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0191 - accuracy: 0.9936
1512/1688 [=========================&gt;....] - ETA: 0s - loss: 0.0190 - accuracy: 0.9936
1536/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0192 - accuracy: 0.9936
1559/1688 [==========================&gt;...] - ETA: 0s - loss: 0.0192 - accuracy: 0.9935
1582/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0197 - accuracy: 0.9934
1606/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0197 - accuracy: 0.9933
1629/1688 [===========================&gt;..] - ETA: 0s - loss: 0.0197 - accuracy: 0.9933
1653/1688 [============================&gt;.] - ETA: 0s - loss: 0.0201 - accuracy: 0.9932
1677/1688 [============================&gt;.] - ETA: 0s - loss: 0.0205 - accuracy: 0.9931
1688/1688 [==============================] - 4s 2ms/step - loss: 0.0204 - accuracy: 0.9931 - val_loss: 0.0783 - val_accuracy: 0.9812
Test accuracy after fine tuning: 0.9818000197410583
</pre></div>
</div>
</div>
<div class="section" id="model-conversion">
<h2>6. Model conversion<a class="headerlink" href="#model-conversion" title="Permalink to this headline">¶</a></h2>
<p>After having obtained a quantized model with satisfactory performance, it can
be converted to a model suitable to be used in the Akida NSoC in inference
mode. The <a class="reference external" href="../api_reference/cnn2snn_apis.html#convert">convert</a>
function returns a model in Akida format, ready for the Akida NSoC or the
Akida Execution Engine.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One needs to supply the coefficients used to rescale the input
dataset before the training - here <code class="docutils literal notranslate"><span class="pre">input_scaling</span></code>.</p>
</div>
<p>As with Keras, the summary() method provides a textual representation of the
Akida model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cnn2snn</span> <span class="kn">import</span> <span class="n">convert</span>

<span class="n">model_akida</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">model_quantized</span><span class="p">,</span> <span class="n">input_scaling</span><span class="o">=</span><span class="n">input_scaling</span><span class="p">)</span>
<span class="n">model_akida</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">model_akida</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">raw_x_test</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_y_test</span> <span class="o">==</span> <span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test accuracy after conversion:&#39;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>

<span class="c1"># For non-regression purpose</span>
<span class="k">assert</span> <span class="n">accuracy</span> <span class="o">&gt;</span> <span class="mf">0.97</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>                                     Model Summary
________________________________________________________________________________________
Layer (type)                               Output shape  Kernel shape
========================================================================================
conv2d (InputConvolutional)                [13, 13, 32]  (3, 3, 1, 32)
________________________________________________________________________________________
separable_conv2d (SeparableConvolutional)  [7, 7, 64]    (3, 3, 32, 1), (1, 1, 32, 64)
________________________________________________________________________________________
dense (FullyConnected)                     [1, 1, 10]    (1, 1, 3136, 10)
________________________________________________________________________________________
Input shape: 28, 28, 1
Backend type: Software - 1.8.10


Test accuracy after conversion: 0.9826
</pre></div>
</div>
<p>Depending on the number of samples you run, you should find a
performance of around 98% (better results can be achieved using more
epochs for training).</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  55.237 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-plot-cnn-flow-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/5e3bf4dfd4795a473358be232d14448e/plot_cnn_flow.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_cnn_flow.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/7d452896f8a0cf5503747c045ac9c320/plot_cnn_flow.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_cnn_flow.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plot_ds_cnn_kws.html" class="btn btn-neutral float-right" title="DS-CNN/KWS inference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plot_edge_learning_vision.html" class="btn btn-neutral float-left" title="Akida vision edge learning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Copyright 2020, BrainChip Holdings Ltd. All Rights Reserved.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>